#include <Adafruit_NeoPixel.h>
#include <Cytron_PS2Shield.h>

#define PIN 6

// Parameter 1 = number of pixels in strip
// Parameter 2 = pin number (most are valid)
// Parameter 3 = pixel type flags, add together as needed:
//   NEO_KHZ800  800 KHz bitstream (most NeoPixel products w/WS2812 LEDs)
//   NEO_KHZ400  400 KHz (classic 'v1' (not v2) FLORA pixels, WS2811 drivers)
//   NEO_GRB     Pixels are wired for GRB bitstream (most NeoPixel products)
//   NEO_RGB     Pixels are wired for RGB bitstream (v1 FLORA pixels, not v2)
Adafruit_NeoPixel strip = Adafruit_NeoPixel(218, PIN, NEO_GRB + NEO_KHZ800);

Cytron_PS2Shield ps2(10, 11);

uint16_t timey;
uint16_t lastEyeMoveTime = 0;

bool leftEyeClockwise = true;
bool rightEyeClockwise = true;

const uint16_t numLeds = 218;

uint8_t wheelR, wheelG, wheelB;
uint8_t goodColR, goodColG, goodColB, goodColW;

int16_t leftEyeX = 64;
int16_t leftEyeY = 64;
int16_t rightEyeX = 64;
int16_t rightEyeY = 64;
uint8_t eyePrimaryR = 120;
uint8_t eyePrimaryG = 120;
uint8_t eyePrimaryB = 120;

bool eyesAutomatic = false;
bool whiteEyeBackground = true;


void setup() {

  ps2.begin(57600);

  strip.begin();    
  strip.show(); // Initialize all pixels to 'off'

  // Make random more random
  randomSeed(analogRead(0));
}

void loop() {
  strip.setBrightness(20);

  timey = millis();

  ps2ToLights();

  eyeController();

  strip.show();
}

uint8_t ledSections[2] = {
  0,   // 0  eye left
  109,   // 1  eye right
};

uint8_t eyeCoords[109][2] = {
  { 64, 127}, { 78, 125}, { 91, 121}, { 102, 113}, { 113, 104},     { 120, 93}, {125, 80}, {127, 65}, {125, 52}, {120, 38}, // 9
  { 113, 25}, { 103, 11}, { 92, 9}, { 77, 5}, { 65, 4},      { 51, 4}, {38, 9}, {25, 16}, {15, 25}, {8, 38}, // 19
  { 4, 50}, { 2, 64}, { 3, 79}, { 7, 92}, { 15, 104},      { 26, 113}, {37, 122}, {50, 125}, {64, 118}, {77, 115}, // 29
  { 90, 111}, { 101, 102}, { 109, 92}, { 115, 78}, { 117, 65},      { 115, 52}, {111, 39}, {102, 28}, {92, 20}, {80, 15}, // 39
  { 64, 12}, { 51, 15}, { 38, 20}, { 27, 28}, { 19, 38},      { 14, 52}, {12, 66}, {13, 78}, {19, 92}, {27, 103}, // 49
  { 38, 111}, { 50, 115}, { 64, 118}, { 77, 115}, { 88, 101},      { 98, 91}, {105, 78}, {108, 65}, {105, 53}, {99, 40}, // 59
  { 89, 31}, { 78, 24}, { 64, 22}, { 52, 24}, { 40, 30},      { 30, 39}, {23, 52}, {22, 65}, {25, 77}, {30, 90}, // 69
  { 39, 101}, { 50, 106}, { 64, 107}, { 77, 94}, { 88, 89},      { 94, 78}, {97, 65}, {94, 53}, {88, 44}, {80, 36}, // 79
  { 64, 33}, { 52, 35}, { 42, 43}, { 35, 53}, { 32, 65},      { 33, 78}, {40, 88}, {52, 95}, {64, 88}, {75, 85}, // 89
  { 84, 78}, { 87, 65}, { 84, 54}, { 76, 45}, { 64, 44},      { 53, 45}, {45, 54}, {42, 65}, {44, 76}, {54, 85}, // 99
  { 64, 88}, { 72, 74}, { 77, 65}, { 72, 57}, { 64, 53},      { 55, 58}, {52, 54}, {55, 74}, {64, 65}
};

uint16_t eyeSmileyLeds[24] = {
  34, 35, 40, 41, 42, 43, 44, 45, 46,
  47, 48, 53, 54, 57, 58, 61, 62, 63,
  64, 65, 66, 67, 70, 71
};

uint16_t eyeHeartLeds[56] = {
  4,  5,  6, 16, 26, 27, 28, 34, 35, 36,
  37, 38, 43, 44, 45, 50, 51, 52, 53, 54,
  57, 58, 59, 60, 61, 62, 63, 64, 65, 66,
  67, 68, 69, 70, 71, 72, 73, 74, 75, 76,
  77, 78, 79, 80, 81, 82, 83, 84, 85, 86,
  87, 88, 89, 90, 91, 92
};

bool pacManAnimationMask [16][93] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 9    - frame 0
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 9    - frame 1
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,      // 9    - frame 2
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,      // 9    - frame 3
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 0, 0, 0, 0,      // 39
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 9    - frame 4
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 0, 0, 0, 0, 0,      // 39
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 0, 0,      // 59
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,      // 9    - frame 5
    0, 0, 0, 0, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 39
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 0, 0,      // 59
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,      // 9    - frame 6
    0, 0, 0, 0, 0, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 39
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 59
    0, 0, 0, 0, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,      // 9    - frame 7
    0, 0, 0, 0, 0, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 39
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 59
    0, 0, 0, 0, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,      // 9    - frame 8
    0, 0, 0, 0, 0, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 39
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 59
    0, 0, 0, 0, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,      // 9    - frame 9
    0, 0, 0, 0, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 39
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 0, 0,      // 59
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,      // 9    - frame 10
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 0, 0, 0, 0, 0,      // 39
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 0, 0,      // 59
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 0, 0, 0, 0, 0,      // 9    - frame 11
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 0, 0, 0, 0,      // 39
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,      // 9    - frame 12
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 9    - frame 13
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 9    - frame 14
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 9    - frame 15
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0
  },
};

bool pacManAnimationMask2 [8][93] = {
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 9    - frame 0
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 9    - frame 1
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 79
    0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 9    - frame 2
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 69
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 79
    0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1
  },
  { 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 9    - frame 3
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 49
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 69
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 79
    1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
  },
  { 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 9    - frame 4
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 0, 0, 0, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 49
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    0, 1, 1, 1, 1, 1, 1, 1, 0, 1,      // 69
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 9    - frame 5
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 0, 0, 0, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 0, 0, 0,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    0, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 1, 0, 1, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 9    - frame 6
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 0, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 0,      // 59
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1
  },
  { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 9    - frame 7
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 19
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 29
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 39
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 49
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 59
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,      // 69
    1, 1, 1, 1, 0, 0, 0, 1, 1, 1,      // 79
    1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0
  },
};

